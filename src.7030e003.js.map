{"version":3,"sources":["src/index.js"],"names":["rxjs","interval","operators","take","map","width","height","it","delay","ms","Promise","res","setTimeout","genData","numbers","dataRange","takeNumbers","pipe","ev","Math","floor","random","length","Date","now","getNow","toLocaleTimeString","showD3Clock","container","w","cx","cy","h","margin","r","getTimeOfDay","hr","getHours","min","getMinutes","sec","getSeconds","rotationTransform","d","makeClockFace","hourTickLength","round","minuteTickLength","i","tickLength","tickClass","append","attr","selectAll","data","enter","handBackLength","handLength","setInterval","updateHands","transition","ease","d3","easeBounce","$","console","log","root","select","clock","nowText","style","text","storage","source","stream","runStream","subscribe","index","transmission","ts","dataPoint","duration","easeLinear","remove","err","error"],"mappings":"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","file":"src.7030e003.js","sourceRoot":"..","sourcesContent":["import \"./styles.css\";\n\nconst { interval } = rxjs;\nconst { take, map } = rxjs.operators;\n\nconst width = 1200;\nconst height = 250;\nconst it = 1000;\n\nconst delay = (ms) => new Promise((res) => setTimeout(res, ms));\n\nfunction genData() {\n  const numbers = interval(it);\n  const takeCount = 20; // how many data to take\n\n  const dataRange = {\n    min: 0,\n    max: 10\n  };\n\n  const dataPoint = function () {\n    return (\n      Math.floor(Math.random() * (dataRange.max - dataRange.min)) +\n      dataRange.min\n    );\n  };\n\n  const transmission = function () {\n    const delay = [2000, 4000, 6000];\n    const randomIndex = Math.floor(Math.random() * delay.length);\n    return delay[randomIndex];\n  };\n\n  const takeNumbers = numbers.pipe(\n    take(takeCount),\n    map((ev) => [dataPoint(), ev, transmission(), Date.now()])\n  );\n\n  return takeNumbers;\n}\n\nfunction getNow() {\n  return new Date().toLocaleTimeString();\n}\n\nvar showD3Clock = function (container) {\n  var w = 120; // Width of SVG element\n  var h = 120; // Height of SVG element\n\n  var cx = w / 2; // Center x\n  var cy = h / 2; // Center y\n  var margin = 4;\n  var r = w / 2 - margin; // Radius of clock face\n\n  makeClockFace();\n\n  // Create hands from dataset\n  container\n    .selectAll(\"line.hand\")\n    .data(getTimeOfDay())\n    .enter()\n    .append(\"line\")\n    .attr(\"class\", function (d) {\n      return d[0] + \" hand\";\n    })\n    .attr(\"x1\", cx)\n    .attr(\"y1\", function (d) {\n      return cy + handBackLength(d);\n    })\n    .attr(\"x2\", cx)\n    .attr(\"y2\", function (d) {\n      return r - handLength(d);\n    })\n    .attr(\"transform\", rotationTransform);\n\n  // Update hand positions once per second\n  setInterval(updateHands, 1000);\n\n  function makeClockFace() {\n    var hourTickLength = Math.round(r * 0.2);\n    var minuteTickLength = Math.round(r * 0.075);\n    for (var i = 0; i < 60; ++i) {\n      var tickLength, tickClass;\n      if (i % 5 === 0) {\n        tickLength = hourTickLength;\n        tickClass = \"hourtick\";\n      } else {\n        tickLength = minuteTickLength;\n        tickClass = \"minutetick\";\n      }\n      container\n        .append(\"line\")\n        .attr(\"class\", tickClass + \" face\")\n        .attr(\"x1\", cx)\n        .attr(\"y1\", margin)\n        .attr(\"x2\", cx)\n        .attr(\"y2\", margin + tickLength)\n        .attr(\"transform\", \"rotate(\" + i * 6 + \",\" + cx + \",\" + cy + \")\");\n    }\n  }\n\n  function getTimeOfDay() {\n    var now = new Date();\n    var hr = now.getHours();\n    var min = now.getMinutes();\n    var sec = now.getSeconds();\n    return [\n      [\"hour\", hr + min / 60 + sec / 3600],\n      [\"minute\", min + sec / 60],\n      [\"second\", sec]\n    ];\n  }\n\n  function handLength(d) {\n    if (d[0] === \"hour\") return Math.round(0.45 * r);\n    else return Math.round(0.9 * r);\n  }\n\n  function handBackLength(d) {\n    if (d[0] === \"second\") return Math.round(0.25 * r);\n    else return Math.round(0.1 * r);\n  }\n\n  function rotationTransform(d) {\n    var angle;\n    if (d[0] === \"hour\") angle = (d[1] % 12) * 30;\n    else angle = d[1] * 6;\n    return \"rotate(\" + angle + \",\" + cx + \",\" + cy + \")\";\n  }\n\n  function updateHands() {\n    container\n      .selectAll(\"line.hand\")\n      .data(getTimeOfDay())\n      .transition()\n      .ease(d3.easeBounce)\n      .attr(\"transform\", rotationTransform);\n  }\n};\n\n$(function () {\n  console.log(\"ready!\");\n  const root = d3\n    .select(\"#chart\")\n    .append(\"svg\")\n    .attr(\"width\", width)\n    .attr(\"height\", height);\n\n  const clock = root.append(\"g\").attr(\"transform\", \"translate(0,35)\");\n  showD3Clock(clock);\n  const nowText = clock\n    .append(\"text\")\n    .attr(\"x\", 10)\n    .attr(\"y\", 140)\n    .style(\"fill\", \"#d53c97\")\n    .text(\"\" + getNow())\n    .attr(\"font-size\", \"1em\")\n    .attr(\"font-weight\", \"bold\");\n\n  const storage = root.append(\"g\").attr(\"transform\", \"translate(500,50)\");\n  const source = root.append(\"g\").attr(\"transform\", \"translate(130,80)\");\n\n  source\n    .append(\"text\")\n    .attr(\"x\", -40)\n    .attr(\"y\", -60)\n    .style(\"fill\", \"#8a8a8a\")\n    .text(\"Data Source\")\n    .attr(\"font-size\", \"0.8em\");\n\n  source\n    .append(\"text\")\n    .attr(\"x\", 120)\n    .attr(\"y\", -60)\n    .style(\"fill\", \"#8a8a8a\")\n    .text(\"Network transimission\")\n    .attr(\"font-size\", \"0.8em\");\n\n  source\n    .append(\"text\")\n    .attr(\"x\", 400)\n    .attr(\"y\", -60)\n    .style(\"fill\", \"#8a8a8a\")\n    .text(\"Data processing system\")\n    .attr(\"font-size\", \"0.8em\");\n\n  source\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", -50)\n    .attr(\"x2\", 0)\n    .attr(\"y2\", 120)\n    .style(\"stroke\", \"#8a8a8a\")\n    .style(\"stroke-wdith\", 2);\n\n  source\n    .append(\"line\")\n    .attr(\"x1\", 350)\n    .attr(\"y1\", -50)\n    .attr(\"x2\", 350)\n    .attr(\"y2\", 120)\n    .style(\"stroke\", \"#8a8a8a\")\n    .style(\"stroke-wdith\", 2);\n\n  storage\n    .append(\"rect\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"width\", 200)\n    .attr(\"height\", 100)\n    .attr(\"rx\", 10)\n    .style(\"fill\", \"#2c2c2c\")\n    .style(\"stroke\", \"#8934d9\")\n    .style(\"stroke-width\", 4);\n\n  const stream = genData();\n\n  const runStream = async () => {\n    stream.subscribe(\n      ([data, index, transmission, ts]) => {\n        console.log(data, index, transmission, ts);\n        const dataPoint = source.append(\"g\");\n\n        nowText.transition().text(\"\" + getNow());\n\n        dataPoint\n          .append(\"rect\")\n          .attr(\"x\", 0)\n          .attr(\"y\", 0)\n          .attr(\"width\", 60)\n          .attr(\"height\", 40)\n          .attr(\"rx\", 10)\n          .style(\"fill\", \"#d53c97\")\n          .style(\"stroke\", \"#ffffff\")\n          .style(\"stroke-width\", 2)\n          .transition()\n          .delay(transmission)\n          .style(\"fill\", \"#8934d9\")\n          .attr(\"rx\", 0)\n          .style(\"fill-opacity\", 1);\n\n        dataPoint\n          .append(\"text\")\n          .attr(\"x\", 20)\n          .attr(\"y\", 25)\n          .style(\"fill\", \"#fff\")\n          .text(\"\" + index)\n          .attr(\"font-size\", \"0em\")\n          .transition()\n          .attr(\"font-size\", \"1.2em\");\n\n        dataPoint\n          .append(\"text\")\n          .attr(\"x\", 5)\n          .attr(\"y\", 35)\n          .style(\"fill\", \"#fff\")\n          .text(\"\" + ts)\n          .attr(\"font-size\", \"0em\")\n          .transition()\n          .attr(\"font-size\", \"0.4em\");\n\n        dataPoint\n          .transition()\n          .duration(transmission)\n          .ease(d3.easeLinear)\n          .attr(\"transform\", \"translate(300,0)\")\n          .transition()\n          .duration(3000)\n          .ease(d3.easeLinear)\n          .attr(\"transform\", \"translate(500,0)\");\n\n        dataPoint\n          .transition()\n          .delay(3000 + transmission)\n          .remove();\n      },\n      (err) => {\n        console.error(\"something wrong occurred: \" + err);\n      },\n      async () => {\n        console.log(\"done\");\n        await delay(5000);\n        runStream();\n      }\n    );\n  };\n\n  runStream();\n});\n"]}